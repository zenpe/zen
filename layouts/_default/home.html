{{ define "main" }}
<div class="posts-container">
  {{ $paginator := .Paginate (where .Site.RegularPages "Type" "posts") }}
  {{ range $paginator.Pages }}
  <article class="post-card {{ if .Params.featured_image }}has-background-image{{ end }}">
    <!-- 图片部分 -->
    {{ if .Params.featured_image }}
    <div class="post-image">
      <a href="{{ .RelPermalink }}">
        <img src="{{ .Params.featured_image }}" alt="{{ .Title }}">
      </a>
    </div>
    {{ end }}
    <!-- 文字内容部分 -->
    <div class="post-content-wrapper">
      <div class="post-content">
        <h2 class="post-title">
          <a href="{{ .RelPermalink }}">{{ .Title }}</a>
        </h2>
        <div class="post-meta">
          <span class="meta-item">发表于 {{ .Date.Format "2006-01-02" }}</span>
          {{ with .Params.categories }}
          <span class="meta-divider">|</span>
          <span class="meta-item">
            {{ range . }}
              <a href="/categories/{{ . | urlize }}">{{ . }}</a>
            {{ end }}
          </span>
          {{ end }}
          <span class="meta-divider">|</span>
          <span class="meta-item">
            <span id="busuanzi_value_page_pv_{{ .File.UniqueID }}" data-page-url="{{ .Permalink }}">-</span> 次阅读
          </span>
        </div>
        <div class="post-body">
          {{ .Content | plainify | truncate 300 }} <!-- 显示正文内容并截断，去除格式 -->
        </div>
      </div>
    </div>
  </article>
  {{ end }}

  {{ if gt $paginator.TotalPages 1 }}
  <div class="pagination">
    <div class="page-number">{{ $paginator.PageNumber }} / {{ $paginator.TotalPages }}</div>
    {{ if $paginator.HasPrev }}
    <a href="{{ $paginator.Prev.URL }}" class="prev">上一页</a>
    {{ end }}
    {{ if $paginator.HasNext }}
    <a href="{{ $paginator.Next.URL }}" class="next">下一页</a>
    {{ end }}
  </div>
  {{ end }}
</div>

<script>
  // 为首页文章列表添加访问量统计
  document.addEventListener('DOMContentLoaded', function() {
    // 检查Busuanzi是否已加载，如果没有则加载
    if (typeof busuanzi === 'undefined') {
      // Busuanzi脚本应该已经在侧边栏中加载，这里确保它存在
      const checkBusuanzi = setInterval(function() {
        if (typeof busuanzi !== 'undefined') {
          clearInterval(checkBusuanzi);
        }
      }, 100);
      
      // 如果5秒后仍未加载，则手动加载
      setTimeout(function() {
        if (typeof busuanzi === 'undefined') {
          const script = document.createElement('script');
          script.src = '//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js';
          script.async = true;
          document.head.appendChild(script);
        }
      }, 5000);
    }
  });
</script>
{{ end }}