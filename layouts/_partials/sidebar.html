<div class="sidebar">

    <div class="card">
        <h4><i class="fas fa-folder"></i> 分类</h4>
        <ul>
            {{ range site.Taxonomies.categories.ByCount }}
            <li><a href="{{ .Page.Permalink }}">{{ .Page.Title }} ({{ .Count }})</a></li>
            {{ end }}
        </ul>
    </div>

    <div class="card">
        <h4><i class="fas fa-tags"></i> 标签</h4>
        <div class="tags">
            {{ range site.Taxonomies.tags.ByCount }}
            <a href="{{ .Page.Permalink }}">{{ .Page.Title }}</a>
            {{ end }}
        </div>
    </div>

    <div class="card">
        <h4><i class="fas fa-archive"></i> 归档</h4>
        <ul>
            {{ range site.RegularPages.GroupByDate "2006-01" }}
            <li><a href="/archive/">{{ .Key }} ({{ len .Pages }})</a></li>
            {{ end }}
        </ul>
    </div>

    <div class="card">
        <h4><i class="fas fa-info-circle"></i> 网站信息</h4>
        <ul>
            <li>文章数目: {{ len (where site.RegularPages "Type" "in" site.Params.mainSections) }}</li>
            <li>本站访客数: <span id="busuanzi_container_site_uv" style="display:none"><span id="busuanzi_value_site_uv"></span></span></li>
            <li>本站总访问量: <span id="busuanzi_container_site_pv" style="display:none"><span id="busuanzi_value_site_pv"></span></span></li>
            <li>最后更新时间: {{ site.Lastmod.Format "2006-01-02" }}</li>
        </ul>
    </div>
</div>

<script>
  // 侧边栏Busuanzi访问量统计
  document.addEventListener('DOMContentLoaded', function() {
    // 检查Busuanzi是否已加载
    function isBusuanziLoaded() {
      return typeof busuanzi !== 'undefined' && 
             typeof busuanzi.fetch !== 'undefined';
    }
    
    // 显示网站统计元素
    function showSiteStats() {
      const siteContainers = document.querySelectorAll('[id^="busuanzi_container_site_"]');
      siteContainers.forEach(function(container) {
        container.style.display = 'inline';
      });
    }
    
    // 加载Busuanzi脚本
    function loadBusuanzi() {
      if (!isBusuanziLoaded()) {
        var script = document.createElement('script');
        script.src = '//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js';
        script.async = true;
        // 添加错误处理
        script.onerror = function() {
          console.warn('Busuanzi script failed to load');
          // 即使加载失败也显示容器元素
          showSiteStats();
        };
        document.head.appendChild(script);
      }
    }
    
    // 立即尝试加载脚本
    loadBusuanzi();
    
    // 检查Busuanzi是否加载完成
    var checkInterval = setInterval(function() {
      if (isBusuanziLoaded()) {
        clearInterval(checkInterval);
        showSiteStats();
      }
    }, 100);
    
    // 超时处理（5秒后停止检查）
    setTimeout(function() {
      clearInterval(checkInterval);
      showSiteStats();
    }, 5000);
  });
</script>