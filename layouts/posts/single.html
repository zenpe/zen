{{ define "main" }}
  {{ with .Params.featured_image }}
    <div class="post-featured-image-card">
      <div class="featured-image-container">
        <img src="{{ . | absURL }}" alt="{{ $.Title }}" onerror="this.style.display='none';" />
      </div>
    </div>
  {{ end }}
  <div class="post-detail-card">
    <h1 class="post-detail-title">{{ .Title }}</h1>
    <div class="post-detail-meta">
      <span class="meta-item"><span class="meta-icon">ğŸ—“ï¸</span> {{ .Date.Format "2006-01-02" }}</span>
      {{ with .Params.categories }}
      <span class="meta-item"><span class="meta-icon">ğŸ“</span>
        {{ range $index, $category := . }}
          {{ if gt $index 0 }}, {{ end }}<a href="{{ "/categories/" | relLangURL }}{{ . | urlize }}">{{ . }}</a>
        {{ end }}
      </span>
      {{ end }}
      {{ with .Params.author }} 
      <span class="meta-item"><span class="meta-icon">âœï¸</span> {{ . }}</span>
      {{ end }}
      <span class="meta-item"><span class="meta-icon">ğŸ“</span> {{ T "wordCount" .WordCount }}</span>
      <span class="meta-item"><span class="meta-icon">â±ï¸</span> {{ T "readingTime" .ReadingTime }}</span>
      <span class="meta-item" id="page-views">
        <span class="meta-icon">ğŸ‘ï¸</span>
        <span class="meta-text">{{ T "pageViewCount" }}: 
          <span id="busuanzi_value_page_pv">-</span>
        </span>
      </span>
    </div>
    <div class="post-detail-content">
      {{ .Content | replaceRE "<img src=\"([^\"]+)\"" "<img src=\"$1\" onclick=\"enlargeImage(this)\"" | safeHTML }}
    </div>
    <div class="post-detail-tags">
      {{ partial "terms.html" (dict "taxonomy" "tags" "page" .) }}
    </div>
  </div>
  
  <!-- è¯„è®ºå¡ç‰‡ -->
  {{ partial "comments-card.html" . }}
  
  <script>
    // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºè®¿é—®é‡
    document.addEventListener('DOMContentLoaded', function() {
      const pageViewsContainer = document.getElementById('page-views');
      if (pageViewsContainer) {
        pageViewsContainer.style.display = 'inline';
      }
    });
    
    // å›¾ç‰‡ç‚¹å‡»æ”¾å¤§åŠŸèƒ½
    function enlargeImage(img) {
      // åˆ›å»ºé®ç½©å±‚
      const overlay = document.createElement('div');
      overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        cursor: pointer;
      `;
      
      // åˆ›å»ºæ”¾å¤§å›¾ç‰‡
      const enlargedImg = document.createElement('img');
      enlargedImg.src = img.src;
      enlargedImg.style.cssText = `
        max-width: 90%;
        max-height: 90%;
        object-fit: contain;
      `;
      
      // æ·»åŠ åˆ°é®ç½©å±‚
      overlay.appendChild(enlargedImg);
      
      // ç‚¹å‡»å…³é—­
      overlay.addEventListener('click', function() {
        document.body.removeChild(overlay);
      });
      
      // æ·»åŠ åˆ°é¡µé¢
      document.body.appendChild(overlay);
    }
  </script>
{{ end }}