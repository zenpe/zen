{{ define "main" }}
  {{ with .Params.featured_image }}
    <div class="post-featured-image">
      <img src="{{ . | absURL }}" alt="{{ $.Title }}" />
    </div>
  {{ end }}
  <div class="post-detail-card">
    <h1 class="post-detail-title">{{ .Title }}</h1>
    <div class="post-detail-meta">
      <span class="meta-item"><span class="meta-icon">🗓️</span> {{ .Date.Format "2006-01-02" }}</span>
      {{ with .Params.categories }} 
      <span class="meta-item"><span class="meta-icon">📁</span> {{ delimit . ", " }}</span>
      {{ end }}
      {{ with .Params.author }} 
      <span class="meta-item"><span class="meta-icon">✍️</span> {{ . }}</span>
      {{ end }}
      <span class="meta-item" id="page-views">
        <span class="meta-icon">👁️</span>
        <span class="meta-text">阅读量: <span id="busuanzi_value_page_pv">-</span> 次</span>
        <span class="loading-dots">
          <span>.</span><span>.</span><span>.</span>
        </span>
      </span>
    </div>
    <div class="post-detail-content">
      {{ .Content }}
    </div>
    <div class="post-detail-tags">
      {{ partial "terms.html" (dict "taxonomy" "tags" "page" .) }}
    </div>
  </div>

  <script>
    // 页面加载完成后尝试获取访问量数据
    document.addEventListener('DOMContentLoaded', function() {
      // 如果Busuanzi脚本尚未加载，则动态加载
      if (typeof busuanzi === 'undefined') {
        const script = document.createElement('script');
        script.src = '//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js';
        script.async = true;
        document.head.appendChild(script);
        
        // 添加加载动画
        const viewsElement = document.getElementById('page-views');
        viewsElement.classList.add('loading');
      }
      
      // 当Busuanzi加载完成时移除加载动画
      window.pure_mini_js_loaded = function() {
        const viewsElement = document.getElementById('page-views');
        viewsElement.classList.remove('loading');
      };
    });
  </script>
{{ end }}